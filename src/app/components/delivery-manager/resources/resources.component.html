<div class="container-fluid px-4 resource-container">
  <div class="row mb-3 align-items-center">
    <div class="col">
      <label class="mt-3 h4">Resource List</label>
    </div>
  </div>

  <div class="card shadow-sm p-3 resource-card card-highlight">
    <div class="card-body">
      <div class="d-flex justify-content-between align-items-center mb-3 resource-actions">
        <div class="col-3">
          <input type="text" class="form-control search-input" placeholder="Search Here"
            [formControl]="searchControl" />
        </div>
        <div class="col-auto" *ngIf="isAllowedForDML()">
          <button class="btn btn-outline-dark ms-3 add-resource-btn" (click)="openAddModal()" *ngIf="isAllowedForDML()">
            Add Resource
          </button>
        </div>
      </div>

      <div class="table-responsive mt-2">
        <table class="table table-borderless table-striped">
          <thead>
            <tr>
              <th>Action</th>
              <th>ID</th>
              <th>Email</th>
              <th>Name</th>
              <th style="width: 9rem;">Primary Skill</th>
              <th style="width: 9rem;">Secondary Skill</th>

              <th>Role</th>
              <th>Designation</th>
              <th>Exp (Years)</th>
              <th>Reporting Manager</th>
              <th *ngIf="isAllowedForDML()">Allocation</th>
               <th *ngIf="!isAllowedForDML()">Delivery Manager</th>
            </tr>
          </thead>
          <tbody>
            <ng-container *ngIf="totalItems > 0; else noResults">
              <tr *ngFor="let emp of employees; let i = index" [ngClass]="{ 'zebra-row': i % 2 === 1 }">
                <td class="py-1 px-2">
                  <div class="d-flex gap-0">
                    <button type="button" class="btn btn-sm icon-button" (click)="editEmployee(i)" title="Edit"
                      *ngIf="editingIndex !== i">
                      <i class="fa-regular fa-pen-to-square"></i>
                    </button>

                    <button type="button" class="btn btn-sm icon-button position-relative"
                      (click)="viewProjectDetails(emp)" title="View Project Allocations" *ngIf="editingIndex !== i">
                      <i class="fa-regular fa-eye"></i>

                      <span *ngIf="getTotalProjects(emp.allocation) > 0"
                        class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger"
                        style="font-size: 0.6rem;">
                        {{ getTotalProjects(emp.allocation) }}
                        <span class="visually-hidden">project count</span>
                      </span>
                    </button>

                    <!-- Save button -->
                    <button type="button" class="btn btn-sm icon-button" (click)="saveEmployee()" title="Save"
                      *ngIf="editingIndex === i">
                      <i class="fa-solid fa-check"></i>
                    </button>

                    <button type="button" class="btn btn-sm icon-button" (click)="cancelEdit()" title="Cancel"
                      *ngIf="editingIndex === i">
                      <i class="fa-solid fa-xmark"></i>
                    </button>
                  </div>
                </td>

                <!-- Copy ID -->
                <td>
                  <div class="d-flex align-items-center position-relative">
                    <span class="me-2">{{ emp.id }}</span>
                    <i class="fa-solid fa-copy copy-icon" style="cursor: pointer;"
                      (click)="copyToClipboard(emp.id, 'ID')">
                    </i>

                    <!-- Tooltip shown when copiedItem matches ID -->
                    <span *ngIf="copiedItem === emp.id" class="copy-tooltip">
                      Copied!
                    </span>
                  </div>
                </td>

                <!-- Copy Email -->
                <td>
                  <div class="d-flex align-items-center position-relative" style="max-width: 200px">
                    <span class="me-2 text-truncate d-inline-block" style="max-width: 10rem" [attr.title]="emp.emailId">
                      {{ emp.emailId }}
                    </span>
                    <i class="fa-solid fa-copy copy-icon" style="cursor: pointer;"
                      (click)="copyToClipboard(emp.emailId, 'Email')">
                    </i>

                    <!-- Tooltip shown when copiedItem matches Email -->
                    <span *ngIf="copiedItem === emp.emailId" class="copy-tooltip">
                      Copied!
                    </span>
                  </div>
                </td>


                <td>{{ emp.name }}</td>

                <!-- Primary Skill -->
                <td class="py-1 px-2" style="width: 1rem; max-width: 10rem;">
                  <ng-container *ngIf="editingIndex !== i; else editPrimary">
                    <div class="d-flex align-items-center justify-content-between skill-cell">
                      <div class="text-truncate text-secondary"
                        style="max-width: 150px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;"
                        [attr.title]="getPrimarySkills(emp)">
                        {{ getPrimarySkills(emp) || "N/A" }}
                      </div>

                      <!-- <i class="fa-solid fa-cog text-primary flex-shrink-0" (click)="openSkillsModal(emp, true)"></i> -->
                    </div>
                  </ng-container>

                  <ng-template #editPrimary>
                    <div class="position-relative" style="width: 100%">
                      <input type="text" class="form-control form-control-sm pe-5" [value]="getPrimarySkills(emp)"
                        disabled />
                      <i class="fa-solid fa-cog position-absolute top-50 end-0 translate-middle-y me-2 text-primary"
                        (click)="openSkillsModal(emp, true)" style="cursor: pointer"></i>
                    </div>
                  </ng-template>
                </td>

                <!-- Secondary Skill -->
                <td class="py-1 px-2" style="width: 1rem; max-width: 11rem;">
                   <ng-container *ngIf="editingIndex !== i; else ediSecondary">
                  <div class="d-flex align-items-center justify-content-between skill-cell">
                    <div class="text-truncate text-secondary"
                      style="max-width: 150px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;"
                      [attr.title]="getSecondarySkills(emp)">
                      {{ getSecondarySkills(emp) || "N/A" }}
                    </div>


                  </div>
                </ng-container>


                  <ng-template #ediSecondary>
                    <div class="position-relative" style="width: 100%">
                      <input type="text" class="form-control form-control-sm pe-5" [value]="getPrimarySkills(emp)"
                        disabled />
                      <i class="fa-solid fa-cog position-absolute top-50 end-0 translate-middle-y me-2 text-primary"
                        (click)="openSkillsModal(emp, false)" style="cursor: pointer"></i>
                    </div>
                  </ng-template>
                </td>

                <td>
                  <ng-container *ngIf="editingIndex !== i">
                    <div class="me-2 text-truncate d-inline-block text-secondary">
                      {{ emp.role || "NA" }}
                    </div>
                  </ng-container>

                  <form [formGroup]="editForm" *ngIf="editingIndex === i">
                    <input type="text" formControlName="role" class="form-control edit-mode" placeholder="Enter role" />
                  </form>
                </td>
                <td>
                  <ng-container *ngIf="editingIndex !== i">
                  {{ emp.designation }}
                  </ng-container>
                    <form [formGroup]="editForm" *ngIf="editingIndex === i">
                    <input type="text" formControlName="designation" class="form-control edit-mode" placeholder="Enter Designation" />
                  </form>
                </td>
                <td>
                  <ng-container *ngIf="editingIndex !== i">
                  {{ emp.experience }}
                  </ng-container>
                    <form [formGroup]="editForm" *ngIf="editingIndex === i">
                    <input type="text" formControlName="experience" class="form-control edit-mode" placeholder="Enter experience" />
                  </form>
                </td>
<td>
  <ng-container *ngIf="editingIndex !== i">
    {{ emp.reportingManagerName || 'N/A' }}
  </ng-container>

  <ng-container *ngIf="editingIndex === i">
    <a href="#" data-bs-toggle="modal" data-bs-target="#editEmployeeModal" (click)="prepareManagerModal(emp)">
      {{emp.reportingManagerName || 'Select Manager' }}
    </a>
  </ng-container>
</td>



                <!-- <span class="me-2 text-white">View</span>
                      <span class="badge bg-light text-dark rounded-pill">
                        {{ getTotalProjects(emp.allocation) }}

                      </span> -->
                <!-- Deallocate button (multiple of 7) -->
                <td class="allocation-column" *ngIf="isAllowedForDML()">
                  <ng-container *ngIf="canBeUnAllocated(emp.deliveryManagerEmpId); else checkAllocate">
                    <!-- Deallocate -->
                    <div class="allocation-action-card deallocate-card" (click)="confirmDeallocate(emp)">
                      <div class="d-flex align-items-center justify-content-center">
                        <i class="fa-solid fa-user-minus me-1"></i>
                        <span class="action-text">Remove</span>
                      </div>
                      <div class="card-indicator bg-danger"></div>
                    </div>
                  </ng-container>

                  <ng-template #checkAllocate>
                    <ng-container *ngIf="canBeAllocated(emp.deliveryManagerEmpId); else checkUnavailable">
                      <!-- Allocate -->
                      <div class="allocation-action-card allocate-card" (click)="confirmAllocate(emp)">
                        <div class="d-flex align-items-center justify-content-center">
                          <i class="fa-solid fa-user-plus me-1"></i>
                          <span class="action-text">Acquire</span>
                        </div>
                        <div class="card-indicator bg-success"></div>
                      </div>
                    </ng-container>
                  </ng-template>

                  <ng-template #checkUnavailable>
                    <ng-container *ngIf="isUnAvailable(emp.deliveryManagerEmpId); else checkAvailable">
                      <!-- Unavailable -->
                      <div class="allocation-action-card unavailable-card" (click)="markUnavailable(emp)"
                        data-bs-toggle="tooltip" data-bs-placement="top"
                        title="{{getOthermanagerDetails(emp.deliveryManagerEmpId, emp.deliveryManagerName)}}">
                        <div class="d-flex align-items-center justify-content-center">
                          <i class="fa-solid fa-user-clock me-1"></i>
                          <span class="action-text">Unavailable</span>
                        </div>
                        <div class="card-indicator cozentus-bg"></div>
                      </div>
                    </ng-container>
                  </ng-template>



                  <ng-template #checkAvailable>
                    <ng-container *ngIf="i % 5 === 0">
                      <!-- Available -->
                      <div class="allocation-action-card available-card">
                        <div class="d-flex align-items-center justify-content-center">
                          <i class="fa-solid fa-user-check me-1"></i>
                          <span class="action-text">Available</span>
                        </div>
                        <div class="card-indicator bg-info"></div>
                      </div>
                    </ng-container>
                  </ng-template>
                </td>

                <td *ngIf="!isAllowedForDML()">
                  <ng-container *ngIf="emp.deliveryManagerName">
                    {{ emp.deliveryManagerName }}
                  </ng-container>
                  <ng-container *ngIf="!emp.deliveryManagerName">
                    <span class="text-muted">Not Assigned</span>
                </ng-container>
              </td>


              </tr>
            </ng-container>

            <ng-template #noResults>
              <tr>
                <td colspan="8" class="text-center text-muted py-3">
                  No results found.
                </td>
              </tr>
            </ng-template>
          </tbody>
        </table>
      </div>

      <div class="d-flex justify-content-end align-items-center">
        <div class="d-flex justify-content-between align-items-center w-100 custom-font">
          <div class="ms-auto text-end me-1">
            <span class="small">
              Showing
              {{ (currentPage - 1) * pageSize + (employees.length ? 1 : 0) }}
              to
              {{ (currentPage - 1) * pageSize + employees.length }}
              of {{ totalItems }} entries
            </span>
          </div>
          <div class="d-flex align-items-center">
            <button class="btn btn-outline-secondary btn-sm mx-1" style="
                width: 25px;
                height: 25px;
                padding: 0;
                display: flex;
                align-items: center;
                justify-content: center;
              " (click)="goToFirstPage()" [disabled]="currentPage === 1">
              <span><i class="fa-regular fa-angle-double-left"></i></span>
            </button>
            <button class="btn btn-outline-secondary btn-sm mx-1" style="
                width: 25px;
                height: 25px;
                padding: 0;
                display: flex;
                align-items: center;
                justify-content: center;
              " (click)="goToPreviousPage()" [disabled]="currentPage === 1">
              <span><i class="fa-regular fa-angle-left"></i></span>
            </button>
            <button class="btn btn-outline-secondary btn-sm mx-1" style="
                width: 25px;
                height: 25px;
                padding: 0;
                display: flex;
                align-items: center;
                justify-content: center;
              ">
              {{ currentPage }}
            </button>
            <button class="btn btn-outline-secondary btn-sm mx-1" style="
                width: 25px;
                height: 25px;
                padding: 0;
                display: flex;
                align-items: center;
                justify-content: center;
              " (click)="goToNextPage()" [disabled]="currentPage === totalPages">
              <span><i class="fa-regular fa-angle-right"></i></span>
            </button>
            <button class="btn btn-outline-secondary btn-sm mx-1" style="
                width: 25px;
                height: 25px;
                padding: 0;
                display: flex;
                align-items: center;
                justify-content: center;
              " (click)="goToLastPage()" [disabled]="currentPage === totalPages">
              <span><i class="fa-regular fa-angle-double-right"></i></span>
            </button>
            <select class="form-select form-select-sm ms-2" style="width: 60px" [(ngModel)]="pageSize"
              (change)="onPageSizeChange()">
              <option [value]="5">5</option>
              <option [value]="10">10</option>
              <option [value]="15">15</option>
              <option [value]="20">20</option>
            </select>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Edit Modal -->
  <div class="modal fade" id="editEmployeeModal" tabindex="-1" aria-labelledby="editEmployeeLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
      <div class="modal-content p-3">
        <div class="modal-header">
          <h5 class="modal-title" id="editEmployeeLabel">Edit Resource</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <form [formGroup]="editForm">
            <!-- Employee Details Form -->


            <!-- Accordion for Project Manager -->
            <div class="accordion mt-4" id="managerAccordion">
              <div class="accordion-item">
                <h2 class="accordion-header" id="headingManager">
                  <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                    data-bs-target="#collapseManager" aria-expanded="false" aria-controls="collapseManager">
                    Select Reporting Manager
                  </button>
                </h2>
                <div id="collapseManager" class="accordion-collapse collapse" aria-labelledby="headingManager"
                  data-bs-parent="#managerAccordion">
                  <div class="accordion-body p-3">
                    <!-- Search -->
                    <input type="text" class="form-control mb-3" placeholder="Search managers..."
                      [value]="managerSearchText" (input)="managerSearchText = $any($event.target).value" />

                    <!-- Manager List -->
                    <!-- Manager List (Inside Accordion Body or Any Container) -->
                    <div class="manager-list overflow-auto" style="max-height: 300px">
                      <div *ngFor="let manager of filteredManagers" class="card p-2 mb-2 manager-card" [class.bg-info]="
                          editForm.get('reportingManager')?.value ===
                          manager.empId
                        " (click)="
                          editForm
                            .get('reportingManager')
                            ?.setValue(manager.empId)
                        " style="cursor: pointer">
                        <div class="d-flex justify-content-between align-items-center">
                          <div>
                            <h6 class="mb-0">{{ manager.name }}</h6>
                            <small class="text-muted">{{
                              manager.emailId
                              }}</small>
                          </div>
                          <input class="form-check-input" type="radio" name="reportingManager" [value]="manager.empId"
                            [checked]="
                              editForm.get('reportingManager')?.value === manager.empId
                            " (click)="$event.stopPropagation()" />
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Save</button>
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
            Cancel
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Project Detail Modal -->
  <div class="modal fade" id="projectDetailsModal" tabindex="-1" aria-labelledby="projectDetailsLabel"
    aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
      <div class="modal-content p-3">
        <div class="modal-header cozentus-bg text-white">
          <h5 class="modal-title" id="projectDetailsLabel">
            Project Details - {{ selectedEmployee.name }}
          </h5>
          <button type="button bg-white" class="btn-close" style="filter: brightness(0) invert(1)"
            data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <ng-container *ngIf="selectedProjects.length > 0; else noProjects">
            <div class="accordion" id="projectAccordion">
              <div class="accordion-item" *ngFor="let project of selectedProjects; let i = index">
                <h2 class="accordion-header" [id]="'heading' + i">
                  <button class="accordion-button cozentus-bg" [class.collapsed]="i !== 0" type="button"
                    data-bs-toggle="collapse" [attr.data-bs-target]="'#collapse' + i" aria-expanded="true"
                    [attr.aria-controls]="'collapse' + i">
                    <div class="d-flex justify-content-between w-100 me-3 text-white">
                      <span class="fw-bold">{{ project.projectName }}</span>
                      <small class="text-white text-light">{{ project.startDate }} - {{ project.endDate }}</small>
                    </div>
                  </button>
                </h2>
                <div [id]="'collapse' + i" class="accordion-collapse collapse" [class.show]="i === 0"
                  [attr.aria-labelledby]="'heading' + i" data-bs-parent="#projectAccordion">
                  <div class="accordion-body">
                    <div class="row">
                      <div class="col-md-6">
                        <p class="mb-2">
                          <strong class="cozentus-text-primary">Project Name:</strong><br />
                          {{ project.projectName }}
                        </p>
                        <p class="mb-2">
                          <strong class="cozentus-text-primary">Project Manager:</strong><br />
                          {{ project.projectManager || "N/A" }}
                        </p>
                      </div>
                      <div class="col-md-6">
                        <p class="mb-2">
                          <strong class="cozentus-text-primary">Start Date:</strong><br />
                          {{ project.startDate || "N/A" }}
                        </p>
                        <p class="mb-2">
                          <strong class="cozentus-text-primary">End Date:</strong><br />
                          {{ project.endDate || "N/A" }}
                        </p>
                      </div>
                      <div class="col-12">
                        <p class="mb-3">
                          <strong class="cozentus-text-primary">Description:</strong><br />
                          {{ project.description || "N/A" }}
                        </p>
                        <!-- Button aligned to bottom right -->
                        <div class="text-end" *ngIf="!isUnAvailable(selectedEmployee.deliveryManagerEmpId);">
                          <button class="btn btn-danger" (click)="deallocateFromProject(project)">
                            Deallocate from Project
                          </button>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </ng-container>

          <ng-template #noProjects>
            <div class="text-center text-muted py-4">
              <i class="fa-regular fa-folder-open fa-3x mb-3"></i>
              <p class="mb-0">No projects assigned to this resource.</p>
            </div>
          </ng-template>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
            Close
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Delete Confirmation Modal -->
  <div class="modal fade" id="deleteConfirmationModal" tabindex="-1" aria-labelledby="deleteConfirmationLabel"
    aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header flex-column align-items-start pb-0" style="border-bottom: none">
          <h5 class="modal-title" id="deleteConfirmationLabel">
            Delete Resource
          </h5>
          <hr class="modal-title-line w-100 m-0 mt-3" />
          <button type="button" class="btn-close position-absolute end-0 top-0 m-3" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <p>
            Are you sure that you want to delete resource
            <span class="fw-bold">{{ selectedEmployee.name }}</span>?
          </p>
        </div>
        <div class="modal-footer justify-content-end border-0 pt-0">
          <button type="button" class="btn btn-danger px-4" (click)="confirmDelete()">
            Yes
          </button>
          <button type="button" class="btn btn-outline-secondary px-4 ms-2" data-bs-dismiss="modal">
            No
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Toast Message -->
  <div class="toast align-items-center text-white bg-success border-0 position-fixed bottom-0 end-0 m-4" role="alert"
    aria-live="assertive" aria-atomic="true" id="successToast" data-bs-delay="3000">
    <div class="d-flex">
      <div class="toast-body">
        {{ toastMessage }}
      </div>
      <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"
        aria-label="Close"></button>
    </div>
  </div>

  <!-- Redesigned Add Resource Modal -->
  <!-- Refined Modal Using Accordion for Manager Selection -->
  <!-- Redesigned Add Resource Modal -->
  <!-- Refined Modal Using Accordion for Manager Selection -->
  <div class="modal fade" id="addEmployeeModal" tabindex="-1" aria-labelledby="addEmployeeLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
      <div class="modal-content p-3">
        <div class="modal-header cozentus-bg text-white">
          <h5 class="modal-title text-white">Add New Resource</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
        </div>

        <div class="modal-body">
          <form [formGroup]="resourceForm">
            <div class="row">
              <!-- ID -->
              <div class="col-md-6 mb-3">
                <label>ID <span class="text-danger">*</span></label>
                <input type="text" class="form-control" formControlName="id" [ngClass]="{
                    'is-invalid':
                      resourceForm.get('id')?.invalid &&
                      resourceForm.get('id')?.touched
                  }" />
                <div class="invalid-feedback" *ngIf="
                    resourceForm.get('id')?.invalid &&
                    resourceForm.get('id')?.touched
                  ">
                  ID is required
                </div>
              </div>

              <!-- Name -->
              <div class="col-md-6 mb-3">
                <label>Name <span class="text-danger">*</span></label>
                <input type="text" class="form-control" formControlName="name" [ngClass]="{
                    'is-invalid':
                      resourceForm.get('name')?.invalid &&
                      resourceForm.get('name')?.touched
                  }" />
                <div class="invalid-feedback"
                  *ngIf="resourceForm.get('name')?.errors?.['required'] && resourceForm.get('name')?.touched">
                  Name is required
                </div>
                <div class="invalid-feedback"
                  *ngIf="resourceForm.get('name')?.errors?.['pattern'] && resourceForm.get('name')?.touched">
                  Only alphabets and spaces allowed
                </div>
              </div>

              <!-- Email -->
              <div class="col-md-6 mb-3">
                <label>Email <span class="text-danger">*</span></label>
                <input type="email" class="form-control" formControlName="emailId" [ngClass]="{
                    'is-invalid':
                      resourceForm.get('emailId')?.invalid &&
                      resourceForm.get('emailId')?.touched
                  }" />
                <div class="invalid-feedback"
                  *ngIf="resourceForm.get('emailId')?.errors?.['required'] && resourceForm.get('emailId')?.touched">
                  Email is required
                </div>
                <div class="invalid-feedback"
                  *ngIf="resourceForm.get('emailId')?.errors?.['email'] && resourceForm.get('emailId')?.touched">
                  Enter a valid email
                </div>
              </div>

              <!-- Phone Number -->
              <div class="col-md-6 mb-3">
                <label>Phone Number <span class="text-danger">*</span></label>
                <input type="text" class="form-control" formControlName="phoneNumber" [ngClass]="{
                    'is-invalid':
                      resourceForm.get('phoneNumber')?.invalid &&
                      resourceForm.get('phoneNumber')?.touched
                  }" />
                <div class="invalid-feedback"
                  *ngIf="resourceForm.get('phoneNumber')?.errors?.['required'] && resourceForm.get('phoneNumber')?.touched">
                  Phone number is required
                </div>
                <div class="invalid-feedback"
                  *ngIf="resourceForm.get('phoneNumber')?.errors?.['pattern'] && resourceForm.get('phoneNumber')?.touched">
                  Enter a valid 10-digit mobile number
                </div>
              </div>

              <!-- Designation -->
              <div class="col-md-6 mb-3">
                <label>Designation <span class="text-danger">*</span></label>
                <input type="text" class="form-control" formControlName="designation" [ngClass]="{
                    'is-invalid':
                      resourceForm.get('designation')?.invalid &&
                      resourceForm.get('designation')?.touched
                  }" />
                <div class="invalid-feedback"
                  *ngIf="resourceForm.get('designation')?.errors?.['required'] && resourceForm.get('designation')?.touched">
                  Designation is required
                </div>
                <div class="invalid-feedback"
                  *ngIf="resourceForm.get('designation')?.errors?.['pattern'] && resourceForm.get('designation')?.touched">
                  Only alphabets allowed
                </div>
              </div>

              <!-- Experience -->
              <div class="col-md-6 mb-3">
                <label>Experience (Years) <span class="text-danger">*</span></label>
                <input type="number" class="form-control" formControlName="experience" [ngClass]="{
                    'is-invalid':
                      resourceForm.get('experience')?.invalid &&
                      resourceForm.get('experience')?.touched
                  }" />
                <div class="invalid-feedback"
                  *ngIf="resourceForm.get('experience')?.errors?.['required'] && resourceForm.get('experience')?.touched">
                  Experience is required
                </div>
                <div class="invalid-feedback"
                  *ngIf="resourceForm.get('experience')?.errors?.['min'] && resourceForm.get('experience')?.touched">
                  Experience must be 0 or more
                </div>
                <div class="invalid-feedback"
                  *ngIf="resourceForm.get('experience')?.errors?.['pattern'] && resourceForm.get('experience')?.touched">
                  Enter valid experience (e.g., 2.5)
                </div>
              </div>

              <!-- Role -->
              <div class="col-md-6 mb-3">
                <label>Role <span class="text-danger">*</span></label>
                <input type="text" class="form-control" formControlName="role" [ngClass]="{
                    'is-invalid':
                      resourceForm.get('role')?.invalid &&
                      resourceForm.get('role')?.touched
                  }" />
                <div class="invalid-feedback"
                  *ngIf="resourceForm.get('role')?.errors?.['required'] && resourceForm.get('role')?.touched">
                  Role is required
                </div>
                <div class="invalid-feedback"
                  *ngIf="resourceForm.get('role')?.errors?.['pattern'] && resourceForm.get('role')?.touched">
                  Only alphabets allowed
                </div>
              </div>

              <div class="col-md-6 mb-3">
                <label>Resource Role <span class="text-danger">*</span></label>
                <select class="form-select" formControlName="resourceRole" [ngClass]="{
      'is-invalid':
        resourceForm.get('resourceRole')?.invalid &&
        resourceForm.get('resourceRole')?.touched
    }">
                  <option value="" disabled selected>Select a role</option>
                  <option value="DELIVERY_MANAGER">Delivery Manager</option>
                  <option value="PROJECT_MANAGER">Project Manager</option>
                  <option value="RESOURCE">Resource</option>
                </select>

                <div class="invalid-feedback"
                  *ngIf="resourceForm.get('resourceRole')?.errors?.['required'] && resourceForm.get('resourceRole')?.touched">
                  Resource Role is required
                </div>
              </div>

            </div>

            <!-- Reporting Manager -->
            <div class="accordion mt-4" id="managerAccordion">
              <div class="accordion-item">
                <h2 class="accordion-header" id="headingManager">
                  <button class="accordion-button collapsed cozentus-bg text-white" type="button"
                    data-bs-toggle="collapse" data-bs-target="#collapseManager" aria-expanded="false"
                    aria-controls="collapseManager">
                    Select Reporting Manager
                  </button>
                </h2>
                <div id="collapseManager" class="accordion-collapse collapse" aria-labelledby="headingManager"
                  data-bs-parent="#managerAccordion">
                  <div class="accordion-body p-3">
                    <input type="text" class="form-control mb-3" placeholder="Search managers..."
                      [value]="managerSearchText" (input)="managerSearchText = $any($event.target).value" />

                    <div class="manager-list overflow-auto" style="max-height: 300px">
                      <div *ngFor="let manager of filteredManagers" class="card p-2 mb-2 manager-card"
                        [class.bg-info]="resourceForm.get('reportingManager')?.value === manager.empId"
                        (click)="selectManager(manager.empId)">
                        <div class="d-flex justify-content-between align-items-center">
                          <div>
                            <h6 class="mb-0">{{ manager.name }}</h6>
                            <small class="text-muted">{{ manager.emailId }}</small>
                          </div>
                          <input class="form-check-input" type="radio" name="reportingManager" [value]="manager.empId"
                            formControlName="reportingManager" (click)="$event.stopPropagation()" />
                        </div>
                      </div>
                    </div>

                    <div class="text-danger mt-2"
                      *ngIf="resourceForm.get('reportingManager')?.invalid && resourceForm.get('reportingManager')?.touched">
                      Please select a reporting manager
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </form>
        </div>

        <!-- Modal Footer -->
        <div class="modal-footer">
          <button class="btn cozentus-bg text-white" (click)="saveNewEmployee()">
            Add
          </button>
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
            Cancel
          </button>
        </div>
      </div>
    </div>
  </div>
  <div class="modal fade" id="skillsModal" tabindex="-1" aria-labelledby="skillsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="skillsModalLabel">
            Manage Skills - {{ selectedEmployee.name }}
          </h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <div class="d-flex justify-content-between align-items-center mb-3">
            <h6 class="mb-0">Skills List</h6>
            <button class="btn btn-primary btn-sm" (click)="addNewSkill()">
              <i class="fa-solid fa-plus me-1"></i> Add Skill
            </button>
          </div>
          <div class="table-responsive">
            <table class="table table-striped">
              <thead>
                <tr>
                  <th>Action</th>
                  <th>Skill Name</th>
                  <th>Experience (Years)</th>
                  <th>Skill Level</th>
                </tr>
              </thead>
              <tbody>
                <ng-container *ngIf="currentEmployeeSkills.length > 0; else noSkills">
                  <tr *ngFor="let skill of currentEmployeeSkills">
                    <td>
                      <button type="button" class="btn btn-link p-0 me-2" (click)="
                        isEditingSkill(skill.skillName)
                          ? saveSkill(skill)
                          : editSkill(skill)
                      ">
                        <i [class]="
                          isEditingSkill(skill.skillName)
                            ? 'fa-solid fa-check text-success'
                            : 'fa-regular fa-pen-to-square'
                        "></i>
                      </button>
                      <button type="button" class="btn btn-link p-0 me-2" *ngIf="isEditingSkill(skill.skillName)"
                        (click)="cancelSkillEdit()">
                        <i class="fa-solid fa-times text-danger"></i>
                      </button>
                      <button type="button" class="btn btn-link p-0" (click)="deleteSkill(skill.skillName)"
                        *ngIf="!isEditingSkill(skill.skillName)">
                        <i class="fa-solid fa-trash text-danger"></i>
                      </button>
                    </td>
                    <td>
                      <!-- Dropdown when adding new skill -->
                      <ng-container *ngIf="isNewSkill && isEditingSkill(skill.skillName)">
                        <div class="d-flex align-items-center" style="gap: 0.5rem; max-width: 100%">
                          <select class="form-select form-select-sm" [(ngModel)]="editingSkillData.name"
                            style="width: 150px">
                            <option value="">Select Skill</option>
                            <option *ngFor="let skillName of skillNames" [value]="skillName">
                              {{ skillName }}
                            </option>
                          </select>

                          <button class="btn btn-outline-primary btn-sm" type="button">
                            <i class="fa fa-plus"></i>
                          </button>
                        </div>
                      </ng-container>

                      <ng-template #newSkillInput>
                        <div class="d-flex align-items-center">
                          <input type="text" class="form-control form-control-sm me-2" [(ngModel)]="newSkillName"
                            placeholder="Enter new skill name" />
                          <button class="btn btn-success btn-sm me-1" type="button">
                            <i class="fa fa-check"></i>
                          </button>
                          <button class="btn btn-secondary btn-sm" type="button">
                            <i class="fa fa-times"></i>
                          </button>
                        </div>
                      </ng-template>

                      <!-- Read-only name otherwise -->
                      <ng-container *ngIf="!isNewSkill || !isEditingSkill(skill.skillName)">
                        {{ skill.skillName }}
                      </ng-container>
                    </td>

                    <td>
                      <ng-container *ngIf="!isEditingSkill(skill.skillName)">
                        {{ skill.skillExperience }}
                      </ng-container>
                      <input *ngIf="isEditingSkill(skill.skillName)" type="number" class="form-control form-control-sm"
                        [(ngModel)]="editingSkillData.experience" min="0" max="20" />
                    </td>
                    <td>
                      <ng-container *ngIf="!isEditingSkill(skill.skillName)">
                        <span class="badge" [class.bg-danger]="skill.level === 'Beginner'"
                          [class.bg-warning]="skill.level === 'Intermediate'"
                          [class.bg-success]="skill.level === 'Advanced'">
                          {{ skill.level }}
                        </span>
                      </ng-container>
                      <select *ngIf="isEditingSkill(skill.skillName)" class="form-select form-select-sm"
                        [(ngModel)]="editingSkillData.level">
                        <option *ngFor="let level of skillLevels" [value]="level">
                          {{ level }}
                        </option>
                      </select>
                    </td>
                  </tr>
                </ng-container>
                <ng-template #noSkills>
                  <tr>
                    <td colspan="5" class="text-center text-muted py-3">
                      No skills added yet. Click "Add Skill" to get started.
                    </td>
                  </tr>
                </ng-template>
              </tbody>
            </table>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" (click)="close()">
            Close
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Allocation Confirmation Modal -->
<div class="modal fade" id="allocationConfirmModal" tabindex="-1" aria-labelledby="allocationConfirmModalLabel"
  aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content shadow-lg rounded-4">

      <div class="modal-header border-0 rounded-top-4 px-4 py-3"
        [ngClass]="confirmationAction === 'allocate' ? 'bg-success' : 'bg-danger'">
        <h5 class="modal-title fw-semibold text-white" id="allocationConfirmModalLabel">
          <i class="fas" [ngClass]="confirmationAction === 'allocate' ? 'fa-user-plus' : 'fa-user-minus'"
            class="me-2"></i>
          Confirm {{ confirmationAction === 'allocate' ? 'Allocation' : 'Deallocation' }}
        </h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>

      <div class="modal-body px-4 py-4">
        <div class="text-center">
          <div class="mb-3">
            <i class="fas fa-question-circle fa-3x"
              [ngClass]="confirmationAction === 'allocate' ? 'text-success' : 'text-danger'"></i>
          </div>
          <h6 class="fw-semibold mb-3">
            Are you sure you want to {{ confirmationAction === 'allocate' ? 'allocate' : 'deallocate' }} this resource?
          </h6>
          <div class="bg-light p-3 rounded-3" *ngIf="selectedEmployeeForAction">
            <p class="mb-1"><strong>Employee:</strong> {{ selectedEmployeeForAction.name }}</p>
            <p class="mb-1"><strong>ID:</strong> {{ selectedEmployeeForAction.id }}</p>
            <p class="mb-0"><strong>Designation:</strong> {{ selectedEmployeeForAction.designation }}</p>
          </div>
          <div class="alert alert-warning mt-3" *ngIf="confirmationAction === 'deallocate'">
            <i class="fas fa-exclamation-triangle me-2"></i>
            This action will remove the resource from their current project assignments.
          </div>
        </div>
      </div>

      <div class="modal-footer bg-light border-0 rounded-bottom-4 px-4 py-3">
        <button type="button" class="btn btn-outline-secondary px-4" data-bs-dismiss="modal">Cancel</button>
        <button type="button" class="btn px-4"
          [ngClass]="confirmationAction === 'allocate' ? 'btn-success' : 'btn-danger'"
          (click)="executeAllocationAction()" data-bs-dismiss="modal">
          <i class="fas" [ngClass]="confirmationAction === 'allocate' ? 'fa-check' : 'fa-trash'" class="me-2"></i>
          {{ confirmationAction === 'allocate' ? 'Allocate' : 'Deallocate' }}
        </button>
      </div>

    </div>
  </div>
</div>

<!-- Skills Management Modal -->
